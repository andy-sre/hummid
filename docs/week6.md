[Return To Weekly Overview](https://iamandyie.github.io/hummid/)

# Week 6 (22/03/21 - 28/03/21)

Now that I have the backend running I can begind working on the front-end and it's functionality.  The first step is
to be able to register users.  

```typescript
const initialValues = {
    fname: "",
    lname: "",
    country: "",
    city: "",
    phone: "",
    email: "",
    password: "",
    cpassword: ""
};

const Register: React.FC = () => {
    const [values, setValues] = useState(initialValues);
    const [error, setError] = useState<string>("");
    const [showError, setShowError] = useState(false);
    const [regions, setRegions] = useState<any>([])
    const [showReg, setShowReg] = useState(false);

    const handleInputChange = (e: any) => {
        const {name, value} = e.target;
        setValues({
            ...values,
            [name]: value,
        });
        if (name === 'country') {
            let selectedCounty = countries.find(country => country.countryShortCode === value);
            setRegions(selectedCounty?.regions);
        }
    };

    const registerUser = async () => {
        let token: string;
        let userId: string;
        db
            .doc(`/users/${values.email}`)
            .get()
            .then((doc) => {
                if (doc.exists) {
                    setError('User already exists')
                    setShowError(true);
                    return;
                } else {
                    return fire
                        .auth()
                        .createUserWithEmailAndPassword(
                            values.email,
                            values.password
                        );
                }
            })
            .then((data: any) => {
                userId = data.user.uid;
                return data.user.getIdToken();
            })
            .then((idtoken: any) => {
                token = idtoken;
                const userCredentials = {
                    fname: values.fname,
                    lname: values.lname,
                    phone: values.phone,
                    country: values.country,
                    city: values.city,
                    email: values.email,
                    createdAt: new Date().toISOString(),
                    userId
                };
                return db
                    .doc(`/users/${values.email}`)
                    .set(userCredentials);
            }).then(() => {
            const userSettings = {
                userId,
                auto: false,
                manual: true,
                minTemp: 10,
                maxTemp: 20,
            };
            db
                .doc(`/settings/${values.email}`)
                .set(userSettings)
            return setShowReg(true);
        })
            .then(() => {
                localStorage.setItem('Token', `Bearer ${token}`);
            })
            .catch(err => {
                console.log(error)
                setError(err)
                return setShowError(true);
            });
    }
    return (..UI/UX Elements Go Here)
}
```

I got stuck at this part understanding how to put the data within an object, so I asked on stackoverflow for some help
[Better way of handling form data via React useState()?](https://stackoverflow.com/questions/66692085/better-way-of-handling-form-data-via-react-usestate)
they showed me how to use an Interface and how to use React [Forms](https://reactjs.org/docs/forms.html) once I had figured
out how forms work with react I was able to start adding data to Firebase.

The first part was making sure I had some error checking to make sure there was not already a user on the database.  To do this
I do a simple if/else checking if the document exists in the collection.  I use the users email as the unique ID for each document
this makes it so I have a string of text I can use for checking information about a specific user/entry

The next part is if there is no current entry I then add the information to the Firebase Auth and then I add the info
I took from the registration form and adding it to the /users/ collection I also then want to create a document in the
/settings/ collection which contains some default values for the heating settings.

I then also store a token generated by Firebase this is unique to the user and will be changed every hour or when the 
user logs in again.  This is important as I will integrate authorization later on.

```typescript
const Login: React.FC = () => {
    const [email, setEmail] = useState<string>("");
    const [password, setPassword] = useState<string>("");
    const [error, setError] = useState<string>("");
    const [showError, setShowError] = useState(false);

    const loginUser = () => {
        try {
            setShowError(false);
            const res = fire.auth().signInWithEmailAndPassword(email, password)
                .then((data: any) => {
                    return data.user.getIdToken()
                }).catch(error => {
                    setError(error);
                    return setShowError(true);
                });
            if (res) localStorage.setItem('Token', `Bearer ${res}`);
        } catch (error) {
            setError(error);
            return setShowError(true);
        }
    };
    return ()
}
```

The next page I worked on was the login page.  This was not too hard to work on.  I just needed to get the form data and
put that into a Firebase method that deals with the login of the user.  Once they log in successfully I save the token
firebase gave the user to their browser.
